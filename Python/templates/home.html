<!DOCTYPE html>
{% extends "layout.html" %}
{% block title %}Home{% endblock %}
{% block content %}

<!-- =========================
    Stylesheets
========================== -->
<link href="{{ url_for('static', filename='css/home.css') }}" rel="stylesheet"/>

<!-- =========================
    Page Title
========================== -->
<h1 class="h4 mb-4">Home</h1>

<!-- =========================
    Total value
========================== -->
<div class="container-fluid d-flex justify-content-center align-items-center" style="visibility:hidden">
    <div class="bg-success text-white p-3 rounded">
        {{to_be_budgeted}} PLN
    </div>
</div>
<!-- =========================
    Headers
========================== -->
<div class="d-flex align-items-center mb-2 px-2" style="gap: 0.5rem;">
    <!-- Empty space for collapse button -->
    <div class="header-gap" style="width: 0; margin-right: 1rem;"></div>

    <!-- CATEGORY label aligned with category names -->
    <span class="category-label" style="font-weight: bold; flex-grow: 1;">CATEGORY</span>

    <!-- Labels aligned with inputs -->
    <div class="d-none d-sm-flex gap-2">
        <span style="width: 10rem;" class="fw-bold">ASSIGNED</span>
        <span style="width: 10rem;" class="fw-bold">ACTIVITY</span>
        <span style="width: 10rem;" class="fw-bold">AVAILABLE</span>
    </div>
</div>

<!-- =========================
    Categories list
========================== -->
{% for name, categories_dict in all_categories.items() %}
{% set outer_loop_index = loop.index %}
<br>
<div class="accordion accordion-flush" id="accordionFlushMain{{ outer_loop_index }}">
    <h5>{{ name }}</h5>
    {% for main_category, categories in categories_dict.items() %}
    <div class="accordion-item">
        <div class="accordion-header d-flex align-items-center flex-wrap"
             id="flush-heading{{ outer_loop_index }}-{{ loop.index }}"
             style="padding: 15px;">
            <button class="accordion-button collapsed me-3" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#flush-collapse{{ outer_loop_index }}-{{ loop.index }}"
                    aria-controls="flush-collapse{{ outer_loop_index }}-{{ loop.index }}"
                    style="width: 40px; padding: 0 0.5rem;">
            </button>
            <span style="font-weight: bold;">{{ main_category or "No Main Category" }}</span>
            <div class="amounts d-flex gap-2 ms-auto flex-wrap">
                <label>
                    <input type="number" step="0.01" min="0" placeholder="0.00" class="form-control form-control-sm"
                           style="min-width: 60px; flex: 1 1 60px;" value="{{ categories | sum(attribute='budgeted') }}"
                           disabled>
                </label>
                <label>
                    <input type="number" step="0.01" min="0" placeholder="0.00" class="form-control form-control-sm"
                           style="min-width: 60px; flex: 1 1 60px;" value="{{ categories | sum(attribute='activity') }}"
                           disabled>
                </label>
                <label>
                    <input type="number" step="0.01" min="0" placeholder="0.00" class="form-control form-control-sm"
                           style="min-width: 60px; flex: 1 1 60px;" value="{{ categories | sum(attribute='balance') }}"
                           disabled>
                </label>
            </div>
        </div>
        <div id="flush-collapse{{ outer_loop_index }}-{{ loop.index }}" class="accordion-collapse collapse"
             aria-labelledby="flush-heading{{ outer_loop_index }}-{{ loop.index }}">
            <div class="accordion-body p-0">
                <ul class="list-group list-group-flush">
                    {% for category in categories %}
                    <li class="list-group-item d-flex">
                        <span style="padding-left: 0;">{{ category.category_name.name }}</span>
                        <div class="amounts d-flex gap-2 ms-auto flex-wrap">
                            <label>
                                <input type="number" step="0.01" min="0" placeholder="0.00"
                                       class="form-control form-control-sm" style="min-width: 60px; flex: 1 1 60px;"
                                       id="{{category.id}}" value="{{ category.budgeted or '' }}">
                            </label>
                            <label>
                                <input type="number" step="0.01" min="0" placeholder="0.00"
                                       class="form-control form-control-sm" style="min-width: 60px; flex: 1 1 60px;"
                                       value="{{ category.activity or '' }}" disabled>
                            </label>
                            <label>
                                <input type="number" step="0.01" min="0" placeholder="0.00"
                                       class="form-control form-control-sm" style="min-width: 60px; flex: 1 1 60px;"
                                       value="{{ category.balance or '' }}" disabled>
                            </label>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endfor %}

<!-- =========================
    Scripts
========================== -->
<script src="../static/js/home.js"></script>


{% endblock %}